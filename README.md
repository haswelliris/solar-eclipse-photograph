# solar-eclipse-photograph
# 金边日环
2020年6月21日厦门日环食摄影，后期处理全流程
## 简介
2020年6月21日的日环食会经过中国大部分地区，福建厦门也是其中之一，环食中心带甚至直接覆盖了整个世界文化遗产——鼓浪屿。厦门当地环食开始的时间是16点11分，太阳高度角35度，不算太高（夏至日的太阳这个时间段也不算太晒，避免被烤熟），同时可以用广角兼顾地景，再考虑到下一次日食经过国内是10年后了，所以这次专程前往厦门看日环食并拍摄。  
由于毫无太阳拍摄经验外加准备确实不充分，情理之中的翻车，不过翻得比我预计得严重些。本来时双机位，α6000配合长焦70-350G等效525mm焦距再套上巴德膜全程追踪太阳，α7r4配合24-105G的广角端24mm拍摄地景合成曝光得到太阳的胡芦串，由于太阳光太强，加上了ND1000减小太阳光强度。  
不幸的是，在环食开始前10分钟，更换了α6000的电池，重新开机之后误触不小心把延时拍摄RAW变成了内录1080P视频。最终环食部分只获得了1080P分辨率的视频，也就能看个环，什么环形山的环齿是没了。回去之后检查前半部分的RAW文件，发现对焦没对准，边缘不够锐，放大明显虚焦。所以，这次长焦端只能用环食部分内录的延时视频快速导了一个视频发朋友圈，要获得更高清视频，就不是LR、PS、PR这些常规摄影软件能做到的了。  
地景部分也翻车很厉害，由于环食开始时忙于肉眼观测、小孔成像、拍照，没有修改曝光参数，此时太阳被挡住了97.6%的面积(对应食分是0.994，日面直径被遮挡部分和日面直径的比值)导致太阳光实际很暗，没有实时调节快门，导致曝光翻车，最终拼借a7r4 6100w超高像素也只得到了小小的一个马赛克环，叠加拼图效果极差。  
如果，如果要想不翻车，一个是要随时查看刚刚拍摄的图像是否清晰，曝光是否准确；二是延时拍摄时测光模式可以用强光，但要注意太阳是否进云层被云挡住以及后期太阳明显变暗的时间，这样会极大影响强光模式的测光结果，最终导致欠曝和闪烁；三是自动对焦在暗光下真的完全不准确，一定手动对焦+对焦锁定；四是追踪还是上赤道仪吧，手动控制且不说容易翻车，后期对其就是给自己挖大坑。  
由于日环食近20年国内只有这一次，上一次的时候我还不知道什么是法师，下一次的时候或许就是老法师了。既然重拍是不可能的，那就只能通过计算摄影学技术，强行把失焦的太阳救回来，强行把手动追踪的图片对齐，强行把地景胡芦串变得又大又圆又亮，也就是本项目的目的。
## 处理思路和流程
### 主要算法
1. 霍夫变换：计算太阳、月球的圆心和半径，用于对齐
2. 超分辨率：把1080P的视频处理到4K
3. 包边卷积： 提高边缘锐度，同时减少锯齿
4. 去卷积与径向频谱峰值：挽救失焦
5. 太阳、地球、月球位置模拟：对齐图片序列，还原葫芦串位置

### 流程
流程图。。。
